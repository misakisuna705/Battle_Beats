class Play_Scene extends Phaser.State{create(){const t=this.game,e=t.active_song,s=button_config.play_scene;this.physics.startSystem(Phaser.Physics.ARCADE),this.bg=new BG({game:this.game,x:-300,y:-640,width:1124,height:1280,key:"bg"}),this.song_beatmap=song_config[e].beatmap[t.active_level];for(let t=0;t<this.song_beatmap.length;++t)this.game.time.events.add(this.song_beatmap[t][1],this.dispatch_note,this,t);this.song_speed=song_config[e].info.bpm*song_config[e].info.nX,this.score=new Score({game:this.game,x:240,y:0,key:"target_button"}),this.tails=[new Tails({game:t,enableBody:!0,index:0}),new Tails({game:t,enableBody:!0,index:1}),new Tails({game:t,enableBody:!0,index:2}),new Tails({game:t,enableBody:!0,index:3})],this.notes=[new Notes({game:t,enableBody:!0,index:0}),new Notes({game:t,enableBody:!0,index:1}),new Notes({game:t,enableBody:!0,index:2}),new Notes({game:t,enableBody:!0,index:3})],this.target_buttons=[new Button({game:t,callback:this.hit_button_0,callbackContext:this},s.target_buttons[0]),new Button({game:t,callback:this.hit_button_1,callbackContext:this},s.target_buttons[1]),new Button({game:t,callback:this.hit_button_2,callbackContext:this},s.target_buttons[2]),new Button({game:t,callback:this.hit_button_3,callbackContext:this},s.target_buttons[3])],this.song_audio=t.add.audio(song_config[e].AudioFilename,1,!1),t.time.events.add(t.height/this.song_speed*1e3,this.play,this)}update(){this.bg.renew()}play(){this.song_audio.play()}dispatch_note(t){const e=this.notes[this.song_beatmap[t][0]].getFirstExists(!1,!1,button_config.play_scene.target_buttons[this.song_beatmap[t][0]].x,0);if(e.exists=!0,e.body.velocity.y=this.song_speed,e.perfect_timing=this.song_beatmap[t][0],e.point=0,3===this.song_beatmap[t].length){const e=this.tails[this.song_beatmap[t][0]].getFirstExists(!1,!1,button_config.play_scene.target_buttons[this.song_beatmap[t][0]].x,0);e.exists=!0,e.body.velocity.y=this.song_speed,e.bonus_time=this.song_beatmap[t][2]-this.song_beatmap[t][1],e.scale.setTo(1,this.song_speed*e.bonus_time/1e3/e.height*e.scale.y)}}hit_button_0(){}hit_button_1(){}hit_button_2(){}hit_button_3(){}}